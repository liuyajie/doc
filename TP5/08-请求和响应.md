#### 一、请求对象

1. 定义

   请求对象是用来获取请求的各个方面的信息实例出来的对象。

2. 使用

   ```php
   // 【1】构造方法注入或操作方法注入，如果是继承了Controller基类，那么可以直接使用$this->request调用
   class Index 
   {
       protected $request;
       public function __construct(Request $request)
       {
   		$this->request = $request;
       }
       public function index()
       {
   		return $this->request->param('name');
       }
       public function test(Request $request)
       {
           $request->param('name');
       }
   }
   
   // 【2】门面模式的调用，可以在模板当中或不方便实例化的地方使用
   class Index
   {
       public function index()
       {
           \think\facade\Request::param('name');
       }
   }
   
   // 【3】助手函数调用，可以在模板当中或不方便实例化的地方使用
   class Index
   {
       public function index()
       {
           \request()->param('name');
       }
   }
   ```

#### 二、请求详情

1. 请求信息

   ```php
   // 【1】常用信息
   $this->request->ip();// 192.168.1.120 客户端IP地址
   $this->request->host(); // tp5.com 域名
   $this->request->root(true); // http://tp5.com 完整的域名
   $this->request->pathinfo();// index/index/index/name/liuyajie pathinfo的信息
   $this->request->module();// admin 模块
   $this->request->controller();// user 控制器
   $this->request->action();// list  方法
   
   // 【2】http 请求头信息 写APP接口时可以用这种方式来传数据，统一管理比较方便
   $this->request->header();
   $this->request->header('user-agent');
   $this->request->header('APUD');
   ```

2. 输入变量

   - 请求变量，GET / POST / REQUEST / PUT / DELETE / PATCH / ROUTE /OPTIONS /PARAM

     ```php
     $this->request->get('name','default','filter');// 只能获取GET传参
     $this->request->route('name','default','filter');// 只能获取pathinfo传参
     $this->request->post('name','default','filter');// 只能获取POST传参
     // 推荐使用这种方式获取请求类型的参数
     $this->request->param('name','default','filter');// 只要是请求类型的参数都可以获取
     ```

   - 系统变量

     ```php
     // 【1】$_SERVER 系统全局服务的信息
     $this->request->server('REMOTE_ADDR'); // 客户端的IP地址
     
     // 【2】$_ENV 框架全局配置的信息，需要在框架的根目录下创建.env配置文件
     $this->request->env('USERNAME');
     
     // 【3】$_COOKIE 信息
     $this->request->cookie('username','默认值','filter');
     
     // 【4】$_SESSION 信息
     $this->request->session('username','默认值','filter');
     ```

   - 默认值

     ```php
     // 第二个参数是默认值，如果没有设置默认值的话，不传的话，返回null
     
     // 【1】前台没有传这个参数，直接使用这个默认值，不会执行过滤函数和最终返回的转义
     // 注意：如果为空字符串的话不会使用到默认值
     $this->request->param('name','default'); // tp.com/index/index/index/age/1
     
     // 【2】使用Filter ID过滤之后不符合的情况会使用默认值
     $this->request->param('email','default',FILTER_VALIDATE_EMAIL);
     $this->request->param('age','default',FILTER_VALIDATE_INT);
     $this->request->param('ip','default',FILTER_VALIDATE_IP);
     
     // is_scalar 判断一个变量是不是标量
     // 变量是number、boolean、string
     $bool = is_scalar($age);
     
     // Filter 是一组过滤函数
     $list = filter_list(); // 获取所有的过滤器
     $fid = filter_id('validate_email');// Filter ID 获取过滤器对应的ID
     
     $email = filter_var('920288326@qq.com',filter_id('validate_email'));// 如果是一个邮箱，则返回这个邮箱，如果不是的话返回false
     $email = filter_var('920288326@qq.com',274);
     $email = filter_var('920288326@qq.com',FILTER_VALIDATE_EMAIL);
     ```

   - 过滤函数

     ```php
     // 第三个参数为过滤函数，可以在配置文件中default_filter=>'htmlspecialchars,strip_tags'指定默认的
     // 【1】使用过滤函数或自定义
     $this->request->param('name','default'); // 使用配置项中的
     $this->request->param('name','default','strtoupper');// 使用用户指定的
     $this->request->param('name','default','myFilter,strtoupper');// 使用用户指定的
     
     // 【2】使用FILTER ID，如果符合的话返回该值，不符合的话返回default
     $this->request->param('name','default',FILTER_VALIDATE_EMAIL);
     ```

   - 最终获取（最终转义）

     ```php
     // 最终转义 /s 字符串， /d 整数， /f 浮点数， /b 布尔值，/a 数组
     $this->param('name/s');
     $this->param('age/d');
     ```

3. 请求类型

   ```php
   // 获取请求方法 
   // get,post,put,delete,patch,options,header
   // ajax pjax json mobile
   // cli cgi
   $this->request->method();
   
   // 判断指定类型，现在不常用
   $this->request->isAjax(); // false
   
   // 请求伪装 get,post,put,delete,patch,options,header
   <form method="post" action="">
       <input type="text" name="name" value="Hello">
       <input type="hidden" name="_method" value="PUT" >
       <input type="submit" value="提交">
   </form>
       
    // 请求伪装 ajax pjax
   tp5.com/index/index/index?_ajax=1
   ```

#### 三、请求其他

1. 伪静态
2. 参数绑定
3. 请求缓存

#### 四、响应

1. 响应输出
2. 响应参数
3. 重定向
4. 文件下载



